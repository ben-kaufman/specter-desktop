{% extends "base.html" %}
{% block main %}
<style>
	.address {
		text-decoration: none;
		color: inherit;
		float: right;
		margin-left: 10px;
	}
	.address:hover {
		color: #fff;
		text-decoration: underline;
	}
	.table-holder .balance {
		display: inline;
	}
	.label {
		text-align: left;
		padding-left: 0;
		float: left;
		width: auto;
	}
	.update {
		display: none;
		float: left;
		margin-right: 5px;
		margin-left: 5px;
	}
	.cancel {
		display: none;
		float: left;
	}
	.edit {
		float: right;
		margin-top: 8px;
	}
</style>
<h1>{{wallet.name}}</h1>
{% from 'includes/components/wallet_menu.jinja' import wallet_menu %}
{{ wallet_menu("wallet_addresses", wallet_alias) }}
{% if ( wallet.fullbalance ) is not none %}
{% from 'includes/components/total_wallet_balances.jinja' import total_wallet_balances %}
{{ total_wallet_balances(wallet, specter) }}
<div style="padding: 0 30px; width: 100%;">
	<nav class="row">
		<a href="./?all=True&view={{viewtype}}" class="btn radio left {% if alladdresses %}checked{% endif %}">History</a>
		<a href="./?all=False&view={{viewtype}}" class="btn radio right {% if alladdresses != True %}checked{% endif %}">UTXO</a>
	</nav>
	<span>View Type: </span><br>
	<div class="dropdown" style="margin-top: 5px;">
		<button class="btn radio dropbtn">{{viewtype|title}} View &#9660;</button>
		<div class="dropdown-content">
			<a href="./?all={{alladdresses}}&view=address">Address View</a>
			<a href="./?all={{alladdresses}}&view=label">Labels View</a>
		</div>
	</div>
</div>
{% set isaddrview = viewtype == "address" %}
{% set accounts = (wallet.active_addresses if isaddrview else wallet.labels) if alladdresses else (wallet.utxoaddresses if isaddrview else wallet.utxolabels)  %}
{% for account in accounts | reverse %}
{% if alladdresses or (wallet.balanceonaddr(account) > 0 if isaddrview else wallet.balanceonlabel(account) > 0) %}
{% set accountlabel = wallet.getaddressname(account, (wallet.active_addresses | length - loop.index0 - 1) if alladdresses else -1) if isaddrview else account %}
<div class="table-holder">
	<br>
	<form action="./?all={{alladdresses}}&view={{viewtype}}" method="POST">
		<br>
		<input type="text" class="label" autocomplete="off" spellcheck="false" id="{{"label" ~ loop.index0}}" name="label" value="{{accountlabel}}" style="border: none; font-size: 1.5em;" disabled />
		<input type="hidden" name="account" value="{{account}}"/>
		<button type="submit" class="btn update" id="{{"save" ~ loop.index0}}" name="action" value="updatelabel">Update</button>
		<button type="button" class="btn cancel" id="{{"cancel" ~ loop.index0}}" onclick="toggleEdit('{{ loop.index0 }}', '{{ accountlabel }}')">Cancel</button>
		<button type="button" class="btn edit" id="{{"edit" ~ loop.index0}}" onclick="toggleEdit('{{ loop.index0 }}', '{{ accountlabel }}')">Edit Label</button>
		<br>
	</form><br><br>
	{% if isaddrview %}
	<a target="blank" class="address" href="{{specter.explorer}}address/{{account}}">{{account}}</a>
	{% endif %}
	<p class="balance">Balance: 
		{{wallet.balanceonaddr(account) if isaddrview else wallet.balanceonlabel(account) | btcamount}} 
		{% if specter.chain !='main' %}t{%endif%}BTC
	</p>
	<br><br>
	{% from 'includes/components/tx_table.jinja' import tx_table %}
	{% from 'includes/components/account_tx_table.jinja' import account_tx_table %}
    {{ tx_table(
		not (wallet.txonaddr(account) if isaddrview else wallet.txonlabel(account) > 0),
		account_tx_table(account, 'history' if alladdresses else 'utxo', viewtype, wallet, specter)
	) }}
</div>
{% endif %}
{% endfor %}
{% endif %}
<script>
	function toggleEdit(id, accountlabel) {
		var edit_button_display = document.getElementById("edit" + id).style.display
		if (edit_button_display === 'none'){
			document.getElementById("label" + id).disabled = 'true'
			document.getElementById("label" + id).style.border = 'none'
			document.getElementById("label" + id).style.textAlign = 'left';
			document.getElementById("label" + id).style.fontSize = '1.5em';
			document.getElementById("label" + id).value = accountlabel
			document.getElementById("edit" + id).style.display = 'block'
			document.getElementById("cancel" + id).style.display = 'none'
			document.getElementById("save" + id).style.display = 'none'
		} else{
			document.getElementById("label" + id).disabled = ''
			document.getElementById("label" + id).style.removeProperty('border');
			document.getElementById("label" + id).style.textAlign = 'center';
			document.getElementById("label" + id).style.removeProperty('font-size');
			document.getElementById("edit" + id).style.display = 'none'
			document.getElementById("cancel" + id).style.display = 'block'
			document.getElementById("save" + id).style.display = 'block'
		}
	}
</script>
{% endblock %}
